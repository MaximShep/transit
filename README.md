# React Native Image Upload & Organized File Storage

Этот проект представляет собой учебное приложение, которое демонстрирует передачу изображений с мобильного клиента (React Native с Expo) на сервер (Node.js). На сервере изображения сохраняются в организованной файловой системе с вложенной структурой на основе сгенерированного HEX-кода, а путь к файлу записывается в SQLite базу данных.

---

## Структура проекта

### Клиент (React Native)
```
client/
├── assets/                # Статические файлы (изображения, шрифты и т.д.)
├── components/
│   └── uploadScreen.js    # Экран загрузки изображения (UI компоненты, кнопки)
├── utils/
│   ├── config.js          # Глобальная переменная с IP-адресом сервера
│   └── utilities.js       # Функции: генерация HEX-кода и загрузка изображения на сервер
├── App.js                 # Точка входа, минимальный код для подключения uploadScreen
├── app.json
├── index.js
└── package.json
```

### Сервер (Node.js)
```
server/
├── Controller/
│   └── uploadController.js  # Логика обработки загрузки: перемещение файла, запись в БД
├── routes/
│   └── uploadRoutes.js      # Маршруты API для загрузки изображений
├── utils/
│   └── hexGenerator.js      # Функция для генерации HEX-кода, если не указан клиентом
├── uploads/
│   └── images/              # Сюда сохраняются загруженные изображения
│       └── ab/
│           └── cd/
│               └── filename.jpg   # Пример пути: /uploads/images/ab/cd/filename.jpg
├── db/
│   └── db.db                # SQLite база данных для хранения путей к файлам
├── config.js                # Конфигурация базы данных
├── index.js                 # Главный файл сервера, подключает middleware и маршруты
├── package.json
└── package-lock.json
```

---

## Используемые технологии

- **React Native + Expo** – для разработки мобильного клиента.
- **Node.js + Express** – для создания REST API сервера.
- **Multer** – для обработки multipart/form-data (загрузка файлов).
- **SQLite** – легковесная база данных для хранения информации о загруженных файлах.
- **CORS** – для обеспечения кросс-доменных запросов между клиентом и сервером.

---

## Ключевые особенности и архитектурные решения

### Организованное хранение изображений
- **Проблема:** При большом количестве файлов в одной папке происходит замедление доступа.
- **Решение:** Файлы сохраняются в папке `uploads/images`, организованные по вложенной структуре, основанной на 4-символьном HEX-коде.  
  *Пример:* Если сгенерирован код `abcd`, то файл сохраняется по пути:
  ```
  /uploads/images/ab/cd/filename.jpg
  ```
- **Дополнительно:** Если клиент не передает HEX-код, сервер генерирует его автоматически с использованием функции из `utils/hexGenerator.js`.

### Модульная организация кода
- **Клиент:**  
  - IP-адрес сервера вынесен в `utils/config.js`, что позволяет легко перенастраивать приложение под разные среды.
  - Логика загрузки и генерация HEX-кода вынесены в `utils/utilities.js` для повторного использования в других проектах.
  - UI-слой реализован в `components/uploadScreen.js`, что упрощает поддержку и масштабирование клиентской части.
  
- **Сервер:**  
  - Код разделён по функциональным блокам: контроллеры в папке `Controller`, маршруты в папке `routes` и вспомогательные функции в `utils`.
  - Файловая система организована так, чтобы обеспечить быстрый доступ к файлам даже при большом их количестве.

---

## Как запустить проект

### Сервер

1. **Установка зависимостей:**
   ```bash
   cd transit_server
   npm install
   ```

2. **Запуск сервера:**
   ```bash
   npm run dev
   ```
   Сервер запустится на порту `8080` (при необходимости можно изменить в `index.js`).

### Клиент

1. **Установка зависимостей:**
   ```bash
   cd transit_client
   npm install
   ```

2. **Запуск Expo-проекта:**
   ```bash
   npx expo start
   ```
   Убедитесь, что IP-адрес сервера в файле `utils/config.js` соответствует вашему окружению.

---

## Тестирование загрузки изображений

### С мобильного устройства
- Запустите Expo-приложение.
- Нажмите кнопку **"Выбрать изображение"** для выбора файла из галереи.
- Нажмите кнопку **"Загрузить изображение"** – изображение будет передано на сервер.
- Проверьте, что изображение сохранилось по пути вида `/uploads/images/ab/cd/filename.jpg` и путь записан в базу данных.

### С использованием Postman
1. Создайте POST-запрос по URL:  
   ```
   http://<SERVER_IP>:8080/upload
   ```
2. Перейдите на вкладку **Body** → **form-data**:
   - Добавьте поле `image` (тип: File) и выберите изображение.
   - Добавьте поле `hexCode` (тип: Text, опционально). Если не указано, сервер сгенерирует его автоматически.
3. Отправьте запрос и убедитесь, что ответ содержит путь к сохранённому файлу.

---

# Круто?

Пример практического применени можно посмотреть [здесь](https://github.com/MaximShep/stories)
